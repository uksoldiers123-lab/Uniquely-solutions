<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Stripe Payment - Dynamic Amount</title>
    <script src="https://js.stripe.com/v3/"></script>
  </head>
  <body>
    <h3>Pay a Dynamic Amount</h3>
    <label>Amount (USD): <input id="amount" type="number" min="1" step="0.01" /></label>
    <div id="card-element" style="margin-top: 12px; padding: 12px; border: 1px solid #ccc; border-radius: 4px;"></div>
    <button id="pay-btn" style="margin-top:12px;">Pay</button>
    <div id="status" style="margin-top:12px;"></div>

    <script>
      // Replace with your Stripe publishable key
      const STRIPE_PUBLISHABLE_KEY = 'pk_test_51Rv1XcJ8rYAVrZVt8iJlItcVIk0sOmnKiveDQUx1TVpr79thl3akjWJWVmvTa5QdWgMzk9ZBaXEAnelyZzI7yLkF00Ejbx8thQ';
      // Your backend URL (Render URL)
      const BACKEND_BASE_URL = 'https://uniquity-api-1.onrender.com';

      const stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
      const elements = stripe.elements();
      const card = elements.create('card');
      card.mount('#card-element');

      document.getElementById('pay-btn').addEventListener('click', async () => {
        const amount = parseFloat(document.getElementById('amount').value);
        if (!amount || amount <= 0) {
          alert('Please enter a valid amount');
          return;
        }

        // 1) Create PaymentIntent on your backend
        const resp = await fetch(`${BACKEND_BASE_URL}/create-payment-intent`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ amount, currency: 'usd' })
        });
        const data = await resp.json();
        if (data.error) {
          document.getElementById('status').textContent = 'Error: ' + data.error;
          return;
        }

        // 2) Confirm the card payment
        const result = await stripe.confirmCardPayment(data.clientSecret, {
          payment_method: { card }
        });

        if (result.error) {
          document.getElementById('status').textContent = 'Payment failed: ' + result.error.message;
        } else if (result.paymentIntent && result.paymentIntent.status === 'succeeded') {
          document.getElementById('status').textContent = 'Payment succeeded!';
        } else {
          document.getElementById('status').textContent = 'Payment status: ' + (result.paymentIntent?.status || 'unknown');
        }
      });
    </script>
  </body>
</html>
