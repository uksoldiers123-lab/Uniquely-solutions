<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Make a Payment — Uniquity Solutions</title>
  <link rel="stylesheet" href="styles.css?v=8" />
  <style>
    /* Optional, minimal inline styles to ensure Stripe card sits nicely in your Card UI */
    #payment-form { display: grid; gap: 12px; max-width: 520px; }
    #card-element { padding: 12px; border: 1px solid #e5e7eb; border-radius: 10px; background: #fff; }
    .btn { display:inline-flex; align-items:center; padding:12px 18px; border-radius:12px; font-weight:700; border:1px solid transparent; cursor:pointer; }
    .btn-primary { background: var(--primary); color:#fff; }
    .error { color: #d14343; font-size: 13px; }
    .success { color: #0f5132; }
  </style>
</head>
<body>
  <!-- Navbar (reuse your site) -->
  <nav class="nav" aria-label="Primary">
    <div class="container nav-inner">
      <a class="brand" href="index.html">
        <span class="brand-mark" aria-hidden="true"></span>
        Uniquity Solutions
      </a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="index.html#services">Services</a>
        <a href="make-payments.html" class="cta">Make a Payment</a>
      </div>
    </div>
  </nav>

  <main id="content" class="container" style="padding:24px 0 60px;">
    <section aria-labelledby="payment-title" class="section">
      <h2 id="payment-title" class="section-label" style="margin-bottom:12px;">
        <span class="dot" style="background:var(--primary); width:8px; height:8px; border-radius:50%; display:inline-block;"></span>
        Payment
      </h2>

      <div class="content-grid" style="grid-template-columns: 1fr 1fr; gap:28px;">
        <!-- Left: Payment form (Stripe) -->
        <div class="card" style="padding:20px;">
          <h3 style="margin-top:0;">Secure Checkout</h3>
          <form id="payment-form" autocomplete="on">
            <div class="field">
              <label class="label" for="payerName">Full name</label>
              <input id="payerName" name="payerName" class="input" type="text" placeholder="Jane Doe" required />
            </div>
            <div class="field">
              <label class="label" for="payerEmail">Email for receipt</label>
              <input id="payerEmail" name="payerEmail" class="input" type="email" placeholder="you@example.com" required />
            </div>
            <div class="field">
              <label class="label" for="invoiceNumber">Invoice or account number</label>
              <input id="invoiceNumber" name="invoiceNumber" class="input" type="text" placeholder="INV-12345" required />
            </div>

            <div class="field">
              <label class="label" for="amount">Amount (USD)</label>
              <input id="amount" name="amount" class="input" type="number" step="0.01" min="1" placeholder="100.00" required />
            </div>

            <div id="card-element" class="field" aria-label="Card details">
              <!-- Stripe Card Element will be inserted here -->
            </div>
            <div id="card-errors" role="alert" class="error" aria-live="polite"></div>

            <button id="submit" class="btn btn-primary" type="submit" style="margin-top:8px;">
              Pay securely
            </button>
            <div id="payment-status" class="small" style="margin-top:8px;"></div>
          </form>
        </div>

        <!-- Right: Help / info (optional) -->
        <aside class="card" style="padding:16px;">
          <h3 style="margin-top:0;">Need help?</h3>
          <p class="muted" style="color:#6b7280;">Have your invoice or account number ready. For issues, contact support.</p>
          <h4>Security & compliance</h4>
          <ul style="margin:0 0 8px; padding-left:20px;">
            <li>PCI DSS Level 1</li>
            <li>TLS encryption</li>
            <li>Tokenized data via Stripe Elements</li>
          </ul>
          <p class="small" style="font-size:12px;">
            Learn more: Compliance · Security
          </p>
        </aside>
      </div>
    </section>
  </main>

  <script src="https://js.stripe.com/v3/"></script>
  <script>
    // TODO: Replace with your actual publishable key
    const PUBLISHABLE_KEY = "YOUR_PUBLISHABLE_KEY";

    // Initialize Stripe
    const stripe = Stripe(PUBLISHABLE_KEY);
    const elements = stripe.elements();
    const card = elements.create("card", { style: { base: { fontSize: "16px", color: "#32325d" } } });
    card.mount("#card-element");

    // Real-time validation errors from the card Element
    card.on("change", function(event) {
      const displayError = document.getElementById("card-errors");
      if (event.error) {
        displayError.textContent = event.error.message;
      } else {
        displayError.textContent = "";
      }
    });

    // Handle form submission
    const form = document.getElementById("payment-form");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // Basic client-side validation
      const payerName = document.getElementById("payerName").value;
      const payerEmail = document.getElementById("payerEmail").value;
      const invoiceNumber = document.getElementById("invoiceNumber").value;
      const amount = document.getElementById("amount").value;

      if (!payerName || !payerEmail || !invoiceNumber || !amount) {
        document.getElementById("payment-status").textContent = "Please fill in all required fields.";
        return;
      }

      // Disable button to prevent double submission
      const submitBtn = document.getElementById("submit");
      submitBtn.disabled = true;
      document.getElementById("payment-status").textContent = "Creating payment intent...";

      // Create PaymentIntent on the server
      try {
        const res = await fetch("/create-payment-intent", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            amount: Math.round(parseFloat(amount) * 100), // amount in cents
            currency: "usd",
            invoice: invoiceNumber,
            receipt_email: payerEmail
          })
        });
        const data = await res.json();
        if (data.error) {
          throw data.error;
        }

        const clientSecret = data.clientSecret;
        // Confirm the card payment
        const result = await stripe.confirmCardPayment(clientSecret, {
          payment_method: {
            // Optionally pass billing details
            billing_details: {
              name: payerName,
              email: payerEmail
            }
          }
        });

        if (result.error) {
          document.getElementById("card-errors").textContent = result.error.message;
          document.getElementById("payment-status").textContent = "";
          submitBtn.disabled = false;
        } else {
          if (result.paymentIntent && result.paymentIntent.status === "succeeded") {
            document.getElementById("payment-status").textContent = "Payment succeeded!";
            document.getElementById("payment-status").className = "success";
            // Optional: redirect or show receipt
          }
        }
      } catch (err) {
        document.getElementById("card-errors").textContent = err?.message ?? "Payment failed.";
        document.getElementById("payment-status").textContent = "";
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>

2) Backend: Node/Express to create the PaymentIntent (copy-paste)

Create a file server.js (or add to your existing server)

const express = require("express");
const app = express();
const bodyParser = require("body-parser");
const Stripe = require("stripe");
const stripe = Stripe(process.env.STRIPE_SECRET_KEY); // set in env

app.use(bodyParser.json());
app.use(express.static("public")); // serves the front-end if you put it in public

// Create a PaymentIntent
app.post("/create-payment-intent", async (req, res) => {
  try {
    const { amount, currency = "usd", invoice, receipt_email } = req.body;

    // You can attach metadata as needed
    const paymentIntent = await stripe.paymentIntents.create({
      amount,
      currency,
      metadata: { invoice },
      receipt_email
    });

    res.json({ clientSecret: paymentIntent.client_secret });
  } catch (err) {
    console.error("Error creating PaymentIntent:", err);
    res.status(500).json({ error: err.message });
  }
});

// Webhooks (optional but recommended)
app.post("/webhook", express.raw({ type: "application/json" }), (req, res) => {
  const sig = req.headers["stripe-signature"];
  const endpointSecret = process.env.STRIPE_WEBHOOK_SECRET;

  let event;

  try {
    event = stripe.webhooks.constructEvent(req.body, sig, endpointSecret);
  } catch (err) {
    console.log("Webhook signature verification failed.");
    return res.sendStatus(400);
  }

  // Handle the event
  switch (event.type) {
    case "payment_intent.succeeded":
      // fulfill order
      break;
    // handle other events as needed
    default:
  }

  res.json({ received: true });
});

const port = process.env.PORT || 4242;
app.listen(port, () => console.log(`Server running on port ${port}`));
