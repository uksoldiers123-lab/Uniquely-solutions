<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Uniquity Solutions — Make a Payment</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=9">

  <!-- Runtime config BEFORE your app code -->
  <script src="/env.js"></script>
</head>
<body>
  <!-- Navbar -->
  <nav class="nav" aria-label="Primary">
    <div class="container nav-inner">
      <a class="brand" href="index.html">
        <span class="brand-mark" aria-hidden="true"></span>
        Uniquity Solutions
      </a>

      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="#services">Services</a>
        <a href="#partners">Partners</a>
        <a href="#careers">Careers</a>
        <a href="#contact" class="cta">Contact</a>
      </div>

      <button class="menu-btn" id="menuBtn" aria-expanded="false" aria-controls="mobileMenu">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile overlay menu (same structure as your site) -->
  <div id="mobileMenu" class="mobile-menu" role="dialog" aria-label="Mobile Navigation">
    <div class="menu-label">On this page</div>
    <a href="index.html">Home</a>
    <a href="#services">Services</a>
    <a href="#partners">Partners</a>
    <a href="#careers">Careers</a>
    <a href="#contact" class="cta">Contact</a>
  </div>

  <header class="hero">
    <div class="container hero-grid">
      <div>
        <p class="section-label"><span class="dot"></span> Make a Payment</p>
        <h1>Secure checkout with Stripe Card input</h1>
        <p class="lead">Enter your amount and card details. Payments are processed securely by Stripe.</p>
      </div>
    </div>

    <div class="content-wrap">
      <div class="container content">
        <div class="content-grid">
          <!-- Left: form (CardElement) -->
          <div>
            <section id="payment-section" aria-labelledby="make-payment">
              <h2 id="make-payment" class="sr-only">Make a Payment</h2>

              <form id="payment-form" autocomplete="off" novalidate>
                <div class="row">
                  <div class="field">
                    <label class="label" for="amount">Amount (USD)</label>
                    <input class="input" id="amount" type="number" step="0.01" min="0.50" placeholder="49.99" value="10.00" required />
                    <small class="svc-note">Minimum $0.50</small>
                  </div>
                  <div class="field">
                    <label class="label" for="description">Description</label>
                    <input class="input" id="description" type="text" maxlength="100" placeholder="Invoice, service, or reference" value="Invoice">
                  </div>
                </div>

                <div class="row">
                  <div class="field">
                    <label class="label">Card details</label>
                    <div id="card-element" style="padding:12px; border:1px solid #ccd; border-radius:6px; min-height:48px;"></div>
                    <div id="card-errors" role="alert" style="color:#d00; min-height:1em; margin-top:8px;"></div>
                  </div>
                </div>

                <button type="submit" id="submit" class="btn btn-primary" style="margin-top:12px;">
                  Pay
                </button>

                <div id="payment-status" style="margin-top:8px; color:#555;"></div>
              </form>
            </section>
          </div>

          <!-- Right: summary (optional) -->
          <aside class="media" aria-label="Payment summary" style="padding:16px; display:grid; align-content:start">
            <div class="partners-title" style="margin-bottom:10px"><span class="dot"></span> Summary</div>
            <div style="display:flex; justify-content:space-between; margin-bottom:8px">
              <span class="svc-note">Item</span><strong id="sum-desc">Invoice</strong>
            </div>
            <div style="display:flex; justify-content:space-between">
              <span class="svc-note">Amount</span><strong id="sum-amt">$10.00</strong>
            </div>
            <hr style="border:0; border-top:1px solid #e5e7eb; margin:12px 0">
            <div style="display:flex; justify-content:space-between; font-weight:800">
              <span>Total</span><span id="sum-total">$10.00</span>
            </div>
          </aside>
        </div>
      </div>
    </div>
  </header>

  <!-- Footer -->
  <footer class="footer" id="contact" aria-label="Footer">
    <div class="container">
      <div class="brand">
        <span class="brand-mark" aria-hidden="true"></span> Uniquity Solutions
      </div>
      <small>© 2004–2025 Uniquity Solutions. All rights reserved.</small>
    </div>
  </footer>

  <!-- Stripe Elements logic (CardElement) -->
  <script src="https://js.stripe.com/v3/"></script>
  <script>
    // Replace with your live key in production. Use pk_test_... for testing.
    // For this example, keep in mind you must serve with https in production.
    const stripe = Stripe('pk_live_XXXXXXXXXXXXXXXXXXXXXXXX'); // TODO: replace with real key
    const API_BASE = 'https://dashboard.uniquitysolutions.com';
    const SUCCESS_URL = 'https://uniquitysolutions.com/success';

    let elements;
    let card;
    let clientSecret;

    // Build or refresh a PaymentIntent
    async function createPaymentIntentForClient() {
      const amountVal = document.getElementById('amount').value;
      const amount = Math.round(parseFloat(amountVal) * 100);
      const description = document.getElementById('description').value || '';

      const res = await fetch(API_BASE + '/api/create-payment-intent-for-client', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount, currency: 'usd', clientCode: 'CLI-001', description })
      });

      const data = await res.json();
      if (!res.ok || !data.clientSecret) {
        const err = data.error || 'Could not initialize payment';
        document.getElementById('payment-status').textContent = err;
        throw new Error('PaymentInitFailed');
      }

      clientSecret = data.clientSecret;

      if (elements && elements.destroy) elements.destroy();
      elements = stripe.elements({ clientSecret });

      card = elements.create('card');
      card.mount('#card-element');
      card.on('change', (e) => {
        if (e.error) {
          document.getElementById('card-errors').textContent = e.error.message;
        } else {
          document.getElementById('card-errors').textContent = '';
        }
      });
    }

    document.getElementById('payment-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!clientSecret) {
        try {
          await createPaymentIntentForClient();
        } catch {
          return;
        }
      }

      const { error } = await stripe.confirmCardPayment(clientSecret, {
        payment_method: { card: card },
        return_url: SUCCESS_URL
      });

      if (error) {
        document.getElementById('payment-status').textContent = error.message;
      } else {
        document.getElementById('payment-status').textContent = 'Payment processing…';
      }
    });

    // Initialize on load
    (async () => { await createPaymentIntentForClient(); })();
  </script>
</body>
</html>
